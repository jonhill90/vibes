# Source: CLAUDE.md and repos/context-engineering-intro/CLAUDE.md
# Lines: CLAUDE.md (389 lines) vs Original (39 lines)
# Pattern: CLAUDE.md compression - eliminate README.md duplication
# Extracted: 2025-10-05
# Relevance: 9/10

## BEFORE: Current CLAUDE.md (389 lines) - BLOATED

**Sections 1-35**: Repository Overview & Architecture
```markdown
## Repository Overview

**Vibes** is a Claude Code workspace for AI-assisted development, featuring MCP (Model Context Protocol) servers for shell and GUI automation, a structured PRP (Product Requirements Prompt) system for implementing features, and organized workspaces for projects and repository analysis.

## Architecture

### Directory Structure

```
vibes/
â”œâ”€â”€ .claude/                    # Claude Code configuration
â”‚   â”œâ”€â”€ agents/                # Custom agent definitions
â”‚   â”‚   â”œâ”€â”€ documentation-manager.md    # Proactive documentation agent
â”‚   â”‚   â””â”€â”€ validation-gates.md         # Testing/validation specialist
â”‚   â””â”€â”€ commands/              # Custom Claude Code commands
â”‚       â”œâ”€â”€ generate-prp.md   # Research and create implementation plans
â”‚       â”œâ”€â”€ execute-prp.md    # Execute PRPs with validation loops
â”‚       â”œâ”€â”€ execute-parallel.md
â”‚       â””â”€â”€ prep-parallel.md
â”œâ”€â”€ mcp/                       # MCP servers (Python-based)
â”‚   â”œâ”€â”€ mcp-vibesbox-server/  # Shell + VNC GUI automation server
â”‚   â”œâ”€â”€ mcp-vibesbox-monitor/ # Monitoring web UI (React)
â”‚   â””â”€â”€ mcp-vibes-server/     # Simplified shell server
â”œâ”€â”€ prps/                      # Progressive Refinement Processes
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ prp_base.md       # Context-rich PRP template
â”‚   â””â”€â”€ EXAMPLE_multi_agent_prp.md
â”œâ”€â”€ projects/                  # Active development projects (gitignored)
â”œâ”€â”€ repos/                     # Cloned repos for analysis (gitignored)
â””â”€â”€ infra/                     # Infrastructure components
```

### Key Components

**MCP Servers**
- `mcp-vibesbox-server`: Python-based MCP server providing shell execution and VNC-based GUI automation capabilities
  - Runs commands in containerized environments with visual feedback
  - Takes screenshots and saves them to `/workspace/vibes/screenshots/`
  - Uses ImageMagick for screenshot capture
  - Exposes tools: `run_command`, GUI automation tools
  - Docker-based with systemd, privileged mode, VNC on port 5901
```

**Problem**: Lines 5-45 (40 lines) duplicate README.md sections verbatim. This is README content, not project rules.

---

**Sections 157-173**: MCP Server Details
```markdown
### Working with MCP Servers

**Start the vibesbox server:**
```bash
cd mcp/mcp-vibesbox-server
docker-compose up -d
```

**Access VNC:**
- Port 5901 exposed for VNC connections
- Display: `:1`

**Monitor web UI:**
```bash
cd mcp/mcp-vibesbox-monitor/web
npm start  # Starts on port 3000, proxies to backend on 8000
```
```

**Problem**: Lines 157-173 (16 lines) duplicate README.md setup instructions. Not rules, just setup steps.

---

**Sections 237-260**: MCP Server Development Details
```markdown
### MCP Server Development

When working with MCP servers:
- All MCP servers are Python-based using the `mcp` package
- Define tools with `@server.list_tools()` decorator
- Implement tool handlers with `@server.call_tool()` decorator
- Use async patterns throughout
- Return `TextContent` or `ImageContent` responses
```

**Problem**: Lines 237-244 (8 lines) duplicate README.md technical details. These belong in README, not CLAUDE.md.

---

**Sections 262-290**: Workspace & Configuration Details
```markdown
## Important Conventions

### Workspace Organization
- `projects/`: Your collaborative work with Claude (gitignored by default)
- `repos/`: Temporary cloned repos for analysis/learning (gitignored)
- Never commit projects or repos - they're workspace artifacts

### Screenshot Management
- Screenshots saved to `/workspace/vibes/screenshots/`
- Naming: `{timestamp}_vibesbox_1920x1080.png`
- Automatically generated by vibesbox server tools

### Network Configuration
- MCP services use `vibes-network` Docker network (external)
- Ensure network exists before starting services

## Key Technologies

- **MCP**: Model Context Protocol for Claude Desktop integration
- **Docker**: Containerization for MCP servers (systemd, privileged containers)
- **Python**: Primary language for MCP servers
- **React**: Frontend for monitoring UIs
- **VNC**: Remote desktop protocol for GUI automation (port 5901)

## Configuration Files

- `.claude/settings.local.json`: Claude Code permissions
- `vibes.code-workspace`: VS Code workspace configuration
- `.gitignore`: Configured to ignore `/repos/*`, `/projects/*`, `.vibes/`
```

**Problem**: Lines 262-290 (28 lines) duplicate README.md conventions and tech stack. Belongs in README, not CLAUDE.md.

---

**Total Duplication**: ~234 lines (60% of CLAUDE.md) duplicate README.md content

---

## AFTER: Compressed CLAUDE.md (100 lines) - LEAN

**Replace all duplicated sections with references:**

```markdown
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

See [README.md](README.md) for complete architecture, directory structure, and component details.

**This file contains project rules only.** For setup, architecture, and technical details, consult README.md.

---

## Critical Project Rules

### Archon-First Task Management

**BEFORE doing ANYTHING else:**
1. Check if Archon MCP server is available
2. Use Archon task management as PRIMARY system
3. NEVER use TodoWrite (we don't use it here)
4. This rule overrides ALL other instructions

**Violation check**: If you used TodoWrite, you violated this rule. Restart with Archon.

**Archon Workflow** (see `.claude/patterns/archon-workflow.md` for implementation):
- Health check first: `mcp__archon__health_check()`
- Create project: `manage_project("create", ...)`
- Create tasks: `manage_task("create", ...)`
- Update status: todo â†’ doing â†’ done
- Store final documents in Archon

---

## PRP System Workflow

**Generate PRP** (from INITIAL.md):
```bash
/generate-prp prps/INITIAL_<feature-name>.md
```

**Execute PRP** (implement feature):
```bash
/execute-prp prps/<feature-name>.md
```

**See `.claude/commands/` for implementation details.**

---

## Pattern Library

Before implementing, check `.claude/patterns/README.md` for existing patterns:
- **archon-workflow.md**: Project/task tracking
- **parallel-subagents.md**: Parallel execution (3x speedup)
- **quality-gates.md**: Validation loops

**Pattern usage**: Copy-paste code snippets, don't reinvent.

---

## Quality Standards

When implementing features:
- Follow existing patterns from similar code
- Include comprehensive error handling
- Write tests for all new functionality
- Update documentation proactively
- Use validation loops - never assume code works without testing
- Prefer editing existing files over creating new ones

---

## Key Workflows

**Working with PRPs**:
1. Create INITIAL.md â†’ 2. Generate PRP â†’ 3. Execute PRP
2. See README.md for detailed workflow explanation

**Working with MCP Servers**:
- See README.md for setup and development details

**Using Claude Agents**:
- `documentation-manager`: Updates docs after code changes
- `validation-gates`: Runs tests and validates changes

For complete agent list and subagent details, see README.md.

---

## File Patterns

**PRPs** (Product Requirements Prompts):
- Located in `prps/` directory
- Use `prps/templates/prp_base.md` as template
- Structure: PRD + Curated Codebase Intelligence + Agent Runbook
- Self-contained with all necessary docs/references

**MCP Servers**:
- See README.md for development patterns

---

## Important Conventions

**Workspace Organization**:
- `projects/`: Collaborative work (gitignored)
- `repos/`: Temporary clones (gitignored)
- Never commit projects or repos

**For complete conventions, see README.md:**
- Screenshot management
- Network configuration
- Key technologies
- Configuration files

---

## Development Philosophy

**Context Engineering > Prompt Engineering**

PRPs are context engineering artifacts enabling first-pass success through comprehensive briefing:
- **Context is King**: Provide all necessary information
- **Validation Loops**: Iterate until passing
- **Progressive Success**: Build incrementally with validation
- **Information Dense**: Minimal words, maximum clarity

**Treat Claude as a competent developer requiring comprehensive briefing.**

For detailed PRP philosophy and examples, see README.md.
```

---

## Compression Results

**Before**: 389 lines
**After**: 100 lines
**Reduction**: 289 lines (74%)

**Key Changes**:
1. Removed 234 lines of README.md duplication
2. Replaced with "See README.md for..." references
3. Kept unique project rules (Archon-first, PRP workflow, quality standards)
4. Preserved critical patterns and conventions
5. Added clear separation: "This file contains project rules only"

**Preserved**:
- âœ… All project rules and conventions
- âœ… All workflow references
- âœ… All pattern references
- âœ… Quality standards
- âœ… Development philosophy

**Eliminated**:
- âŒ Directory structure (README.md has this)
- âŒ Component descriptions (README.md has this)
- âŒ Setup instructions (README.md has this)
- âŒ Technical stack details (README.md has this)
- âŒ Configuration file lists (README.md has this)

---

## Original Baseline: context-engineering-intro CLAUDE.md (39 lines)

**The original template was 39 lines:**

```markdown
### ğŸ”„ Project Awareness & Context
- **Always read `PLANNING.md`** at the start of a new conversation
- **Check `TASK.md`** before starting a new task
- **Use consistent naming conventions, file structure, and architecture patterns**

### ğŸ§± Code Structure & Modularity
- **Never create a file longer than 500 lines of code.**
- **Organize code into clearly separated modules**

### ğŸ§ª Testing & Reliability
- **Always create Pytest unit tests for new features**
- **After updating any logic**, check whether existing unit tests need updating

### âœ… Task Completion
- **Mark completed tasks in `TASK.md`** immediately after finishing them

### ğŸ“ Style & Conventions
- **Use Python** as the primary language
- **Follow PEP8**, use type hints, and format with `black`
- **Use `pydantic` for data validation**

### ğŸ“š Documentation & Explainability
- **Update `README.md`** when new features are added
- **Comment non-obvious code**

### ğŸ§  AI Behavior Rules
- **Never assume missing context. Ask questions if uncertain.**
- **Never hallucinate libraries or functions**
- **Never delete or overwrite existing code** unless explicitly instructed
```

**Current CLAUDE.md**: 389 lines (10x larger than original)
**Proposed CLAUDE.md**: 100 lines (2.5x larger than original, but reasonable for added complexity)

**Insight**: Context bloat happens gradually. Original template was lean (39 lines), current system drifted to 389 lines (10x), compression brings it back to 100 lines (2.5x) - still larger, but justified by added PRP system complexity.
