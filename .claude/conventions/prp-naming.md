# PRP Naming Convention

**Version**: 1.0
**Last Updated**: 2025-10-07
**Status**: Canonical Reference

---

## Purpose

This document establishes the single source of truth for PRP (Planning, Research, Pseudocode) file naming conventions. Following these rules ensures:

- **Consistency**: Predictable file and directory structures across all PRPs
- **Clarity**: No redundant prefixes (prps/prp_feature.md says "prp" twice)
- **Automation**: Tools can reliably extract feature names from filenames
- **Developer Experience**: Auto-detection reduces cognitive load and manual decisions

---

## Core Rules

### Rule 1: No Redundant Prefixes

**NEVER use `prp_` prefix in PRP filenames.**

**Rationale**: Files are stored in the `prps/` directory, which already indicates these are PRPs. Adding `prp_` to the filename violates the DRY (Don't Repeat Yourself) principle.

```
❌ WRONG: prps/prp_context_refactor.md
✅ RIGHT: prps/context_refactor.md

❌ WRONG: prps/prp_user_auth.md
✅ RIGHT: prps/user_auth.md
```

### Rule 2: Workflow Prefixes Are Optional and Auto-Detected

**Use `INITIAL_` prefix for work-in-progress PRPs generated by `/generate-prp`.**

These prefixes are automatically stripped when creating directories and extracting feature names.

```
✅ CORRECT: prps/INITIAL_user_auth.md
           → Feature name: user_auth
           → Directory: prps/user_auth/

✅ CORRECT: prps/INITIAL_api_gateway.md
           → Feature name: api_gateway
           → Directory: prps/api_gateway/
```

**Other workflow prefixes** (currently reserved for future use):
- `EXAMPLE_`: Example/template PRPs (not for production use)

### Rule 3: Final PRPs Have Clean Names

**After `/generate-prp` completes, rename to remove `INITIAL_` prefix.**

```
Before: prps/INITIAL_user_auth.md
After:  prps/user_auth.md
```

This signals the PRP is finalized and ready for execution.

### Rule 4: Feature Names Must Use Valid Characters

**Allowed characters**: Letters (a-z, A-Z), numbers (0-9), underscore (_), hyphen (-)

```
✅ CORRECT: user_auth.md
✅ CORRECT: api-gateway.md
✅ CORRECT: task_management_v2.md

❌ WRONG: user auth.md (space)
❌ WRONG: user@auth.md (special character)
❌ WRONG: user.auth.md (period - reserved for extension)
```

### Rule 5: Case Sensitivity Matters

**Workflow prefixes MUST be uppercase.**

```
✅ CORRECT: INITIAL_user_auth.md
❌ WRONG: initial_user_auth.md
❌ WRONG: Initial_user_auth.md
```

**Rationale**: Uppercase prefixes are visually distinct and easier to auto-detect in code.

### Rule 6: Length Limits

**Feature names should be 50 characters or fewer.**

```
✅ CORRECT: user_authentication_with_jwt.md (33 chars)
⚠️ WARNING: user_authentication_system_with_jwt_tokens_and_refresh.md (59 chars - too long)
```

**Rationale**: Long filenames are harder to work with in terminals and some filesystems have limits.

### Rule 7: Directory Matching

**The directory name MUST match the feature name (without workflow prefix).**

```
PRP File:  prps/INITIAL_user_auth.md
Directory: prps/user_auth/           ✅ Matches
NOT:       prps/INITIAL_user_auth/   ❌ Includes prefix
NOT:       prps/prp_user_auth/       ❌ Redundant prefix
```

---

## Decision Tree

### When Creating a New PRP

```
START: I want to create a new PRP
  │
  ├─→ Using /generate-prp command?
  │   YES → Use INITIAL_ prefix
  │         Example: INITIAL_my_feature.md
  │         (Auto-stripped during processing)
  │   NO  → Use clean name
  │         Example: my_feature.md
  │
  └─→ Is the feature name clear and descriptive?
      YES → Continue
      NO  → Revise name to be more specific
            Example: "auth" → "user_authentication"

END: PRP created with correct naming
```

### When Naming a Feature

```
START: What should I name this feature?
  │
  ├─→ Does it start with "prp_"?
  │   YES → STOP! Remove the prefix
  │         "prp_context_refactor" → "context_refactor"
  │   NO  → Continue
  │
  ├─→ Does it contain only letters, numbers, _, and -?
  │   NO  → STOP! Use only allowed characters
  │         "user auth" → "user_auth"
  │         "user@auth" → "user_auth"
  │   YES → Continue
  │
  ├─→ Is it 50 characters or fewer?
  │   NO  → STOP! Shorten the name
  │         "very_long_descriptive_feature_name_that_goes_on" → "descriptive_feature"
  │   YES → Continue
  │
  └─→ Is it clear what the feature does?
      NO  → Add more context
            "api" → "api_gateway" or "api_client"
      YES → Continue

END: Feature name is valid
```

### When Stripping Prefixes

```
START: Should I use strip_prefix parameter?
  │
  ├─→ Is this an INITIAL_ PRP?
  │   YES → strip_prefix="INITIAL_" (auto-detected in execute-prp)
  │   NO  → Continue
  │
  ├─→ Is this an EXAMPLE_ PRP?
  │   YES → strip_prefix="EXAMPLE_"
  │   NO  → Continue
  │
  ├─→ Is this a prp_ prefixed file?
  │   YES → STOP! Don't use strip_prefix
  │         Instead: Rename the file to remove prp_ prefix
  │         "prp_feature.md" → "feature.md"
  │   NO  → strip_prefix=None (no prefix to strip)

END: Prefix handling determined
```

---

## Examples

### Correct Naming (GREEN)

1. **Simple feature**
   ```
   File: prps/user_auth.md
   Feature name: user_auth
   Directory: prps/user_auth/
   ```

2. **Hyphenated name**
   ```
   File: prps/api-gateway.md
   Feature name: api-gateway
   Directory: prps/api-gateway/
   ```

3. **Multi-word with version**
   ```
   File: prps/task_management_v2.md
   Feature name: task_management_v2
   Directory: prps/task_management_v2/
   ```

4. **Initial PRP (work in progress)**
   ```
   File: prps/INITIAL_new_feature.md
   Feature name: new_feature (prefix auto-stripped)
   Directory: prps/new_feature/
   ```

5. **Descriptive name**
   ```
   File: prps/execution_reliability.md
   Feature name: execution_reliability
   Directory: prps/execution_reliability/
   ```

6. **Example/template PRP**
   ```
   File: prps/EXAMPLE_template_structure.md
   Feature name: template_structure (prefix stripped)
   Directory: prps/template_structure/
   ```

### Incorrect Naming (RED)

1. **Redundant prp_ prefix**
   ```
   ❌ File: prps/prp_context_refactor.md
   ✅ Fix:  prps/context_refactor.md

   Problem: Says "prp" twice (prps/prp_...)
   Impact: Directory naming confusion, violates DRY principle
   ```

2. **Wrong case for workflow prefix**
   ```
   ❌ File: prps/initial_user_auth.md
   ✅ Fix:  prps/INITIAL_user_auth.md (or prps/user_auth.md if finalized)

   Problem: Lowercase "initial_" won't be auto-detected
   Impact: Prefix won't be stripped, breaks automation
   ```

3. **Invalid characters (space)**
   ```
   ❌ File: prps/user auth.md
   ✅ Fix:  prps/user_auth.md

   Problem: Spaces not allowed in feature names
   Impact: Shell escaping issues, breaks path handling
   ```

4. **Invalid characters (special characters)**
   ```
   ❌ File: prps/user@auth.md
   ✅ Fix:  prps/user_auth.md

   Problem: Special characters pose security risk
   Impact: Failed validation, potential command injection
   ```

5. **Too long**
   ```
   ❌ File: prps/very_long_feature_name_that_describes_everything_in_detail.md
   ✅ Fix:  prps/detailed_feature.md

   Problem: 61 characters exceeds 50 character limit
   Impact: Filesystem issues, harder to work with
   ```

6. **Directory doesn't match filename**
   ```
   ❌ File: prps/user_auth.md
      Directory: prps/prp_user_auth/
   ✅ Fix:  prps/user_auth/

   Problem: Directory has redundant prp_ prefix
   Impact: Inconsistent structure, breaks conventions
   ```

---

## Frequently Asked Questions

### Q1: Why can't I use `prp_` as a prefix?

**A**: Files are already in the `prps/` directory, which indicates they are PRPs. Adding `prp_` to the filename is redundant and violates the DRY (Don't Repeat Yourself) principle.

```
prps/prp_feature.md  ← Says "prp" twice
prps/feature.md      ← Clean and clear
```

Additionally, `prp_` is not a workflow prefix like `INITIAL_` or `EXAMPLE_`. It serves no functional purpose.

### Q2: When should I use `INITIAL_` prefix?

**A**: The `/generate-prp` command automatically adds `INITIAL_` to work-in-progress PRPs. You don't need to add it manually.

After `/generate-prp` completes and the PRP is finalized, rename the file to remove `INITIAL_`:

```bash
# After /generate-prp completes:
mv prps/INITIAL_my_feature.md prps/my_feature.md
```

### Q3: What if I have an existing PRP with `prp_` prefix?

**A**: Rename it to follow the convention:

```bash
# Option 1: Using git mv (preserves history)
git mv prps/prp_old_name.md prps/old_name.md

# Option 2: Using regular mv
mv prps/prp_old_name.md prps/old_name.md
```

Then update any references in documentation, Archon projects, or other PRPs.

### Q4: Can I use `strip_prefix="prp_"` to handle legacy files?

**A**: No. `prp_` is not a valid workflow prefix. The `strip_prefix` parameter only accepts:
- `INITIAL_` (for work-in-progress PRPs)
- `EXAMPLE_` (for template PRPs)

If you have a file with `prp_` prefix, rename it instead of trying to strip the prefix.

### Q5: Are hyphens or underscores preferred?

**A**: Both are allowed. Choose based on readability and consistency with related PRPs:

```
✅ user_auth.md       (underscore - more common in Python)
✅ api-gateway.md     (hyphen - more common in URLs)
```

Within a project, pick one style and stick with it.

### Q6: What about Windows reserved names?

**A**: Avoid using Windows reserved device names, even on non-Windows systems:

```
❌ Avoid: con.md, prn.md, aux.md, nul.md, com1.md, lpt1.md
✅ Use:   console.md, printer.md, auxiliary.md, null_handler.md
```

This ensures cross-platform compatibility.

### Q7: What if my feature name is naturally very long?

**A**: Use abbreviations or focus on the most distinctive part:

```
❌ Too long: user_authentication_system_with_jwt_and_refresh_tokens.md
✅ Better:   user_auth_jwt.md
✅ Better:   jwt_authentication.md
```

Add full details in the PRP content, not the filename.

### Q8: Can I have multiple prefixes (e.g., `INITIAL_EXAMPLE_feature.md`)?

**A**: No. Only use one workflow prefix at a time:

```
❌ Wrong: INITIAL_EXAMPLE_feature.md
✅ Right: INITIAL_feature.md (work in progress)
✅ Right: EXAMPLE_feature.md (template)
```

### Q9: How do I know if a PRP is finalized?

**A**: If it lacks the `INITIAL_` prefix and exists in `prps/`, it's considered finalized:

```
INITIAL_feature.md  → Work in progress (from /generate-prp)
feature.md          → Finalized (ready for /execute-prp)
```

### Q10: What happens if I violate these conventions?

**A**: For **new PRPs**, validation will fail with an actionable error message:

```
❌ NAMING CONVENTION VIOLATION: Redundant 'prp_' Prefix
───────────────────────────────────────────────────────
PROBLEM: Feature name contains redundant 'prp_' prefix
EXPECTED: Clean name without 'prp_' prefix
RESOLUTION: Rename prps/prp_feature.md → prps/feature.md
```

For **existing PRPs**, you'll see a warning but execution will continue (backward compatibility).

---

## Technical Implementation

### Feature Name Extraction

The `extract_feature_name()` function implements 6-level validation:

```python
def extract_feature_name(
    filepath: str,
    strip_prefix: str = None,
    validate_no_redundant: bool = True
) -> str:
    """
    Extract and validate feature name from PRP filepath.

    Validation Levels:
    1. Path traversal in full path
    2. Whitelist (alphanumeric + _ - only)
    3. Length (max 50 chars)
    4. Directory traversal in extracted name
    5. Command injection characters
    6. Redundant prefix validation (NEW)
    """
```

### Auto-Detection (Recommended)

The `/execute-prp` command automatically detects `INITIAL_` prefix:

```python
filename = prp_path.split("/")[-1]

if filename.startswith("INITIAL_"):
    feature_name = extract_feature_name(prp_path, strip_prefix="INITIAL_")
else:
    feature_name = extract_feature_name(prp_path)
```

This improves developer experience by removing the need to manually specify `strip_prefix`.

### Prefix Stripping (Critical Fix)

**ALWAYS use `removeprefix()`, NEVER use `replace()`:**

```python
# ❌ WRONG - Replaces ALL occurrences
feature = "INITIAL_INITIAL_test"
feature = feature.replace("INITIAL_", "")  # Returns "test" (both removed!)

# ✅ RIGHT - Only removes leading prefix
feature = "INITIAL_INITIAL_test"
feature = feature.removeprefix("INITIAL_")  # Returns "INITIAL_test" (correct!)
```

**Rationale**: `replace()` removes ALL occurrences of the substring, not just the prefix. This causes bugs when the prefix appears multiple times in the feature name.

### Allowed Prefixes Whitelist

```python
ALLOWED_PREFIXES = {"INITIAL_", "EXAMPLE_"}

if strip_prefix:
    if strip_prefix not in ALLOWED_PREFIXES:
        raise ValueError(
            f"Invalid strip_prefix: '{strip_prefix}'\n"
            f"Allowed: {', '.join(ALLOWED_PREFIXES)}\n"
            f"Never use 'prp_' - it's not a workflow prefix"
        )
```

This prevents security issues and enforces correct usage.

---

## Validation Tools

### Linter (Optional)

A linter script can proactively check all PRPs for naming violations:

```bash
# Run linter
python scripts/lint_prp_names.py

# Expected output:
# ✅ Passed: execution_reliability.md
# ❌ Violation: prp_context_refactor.md (redundant prp_ prefix)
#
# Compliance: 95% (19/20 PRPs)
```

Exit codes:
- `0`: All PRPs compliant
- `1`: Violations found (fails CI)
- `2`: Warnings only (passes CI)

### Manual Validation

Check a single PRP:

```python
from pathlib import Path

# Will raise ValueError if invalid
feature_name = extract_feature_name("prps/my_feature.md")
print(f"✅ Valid feature name: {feature_name}")
```

---

## Migration Guide

### For Existing PRPs with Violations

1. **Identify violations**:
   ```bash
   ls prps/prp_*.md
   ```

2. **Rename each file**:
   ```bash
   git mv prps/prp_old_name.md prps/old_name.md
   ```

3. **Update references**:
   ```bash
   # Find all references
   grep -r "prp_old_name" .

   # Update each reference
   # (In documentation, Archon projects, etc.)
   ```

4. **Verify directory structure**:
   ```bash
   # Directory should match feature name
   ls -d prps/old_name/  # Should exist
   ```

### For New PRPs

Follow the convention from the start:

```bash
# ✅ Correct workflow:
/generate-prp "My Feature Description"
# Creates: prps/INITIAL_my_feature.md

# After finalization:
mv prps/INITIAL_my_feature.md prps/my_feature.md

# ❌ Incorrect workflow:
# Don't manually create with prp_ prefix
```

---

## References

- **Implementation**: `.claude/patterns/security-validation.md` (6-level validation)
- **Commands**: `.claude/commands/execute-prp.md`, `.claude/commands/generate-prp.md`
- **PRP**: `prps/standardize_prp_naming_convention.md` (full specification)
- **Python Docs**: [PEP 616 - String methods to remove prefixes and suffixes](https://peps.python.org/pep-0616/)

---

## Changelog

### Version 1.0 (2025-10-07)
- Initial version
- Established core rules (no prp_ prefix, workflow prefixes, etc.)
- Added decision trees and examples
- Documented FAQ and migration guide
- Created as part of PRP: standardize_prp_naming_convention

---

**Questions or Issues?**
Refer to the PRP that established these conventions: `prps/standardize_prp_naming_convention.md`
